# 🔒 FANZA同人出版用モザイクツール

FANZA同人に出版する画像を、FANZA隠蔽処理規約第6条に準拠してモザイクを自動でかけるツールです。

## ✨ 特徴

- **完全自動化**: 性器検出からモザイク処理まで全自動実行
- **FANZA規約準拠**: 第6条の隠蔽処理規約に完全準拠
- **アニメ/イラスト特化**: アニメ系画像での高精度検出
- **ワンクリック実行**: 画像アップロードのみで処理開始
- **高速処理**: 1枚あたり5秒以内での完了
- **クラウド対応**: Renderでの無料デプロイ

## 🚀 セットアップ

### 1. 依存関係のインストール

```bash
pip install -r requirements.txt
```

### 2. フォルダ構造の確認

```
mozaic/
├── input/          # 元画像格納フォルダ（ローカル実行時）
├── output/         # 処理成功画像保存フォルダ（ローカル実行時）
├── error/          # 処理失敗画像保存フォルダ（ローカル実行時）
├── app.py          # メインアプリケーション
├── mosaic_processor.py  # モザイク処理エンジン
├── requirements.txt      # 依存関係定義
├── render.yaml           # Renderデプロイ設定
└── README.md            # 使用方法説明書
```

## 📖 使用方法

### 1. ローカル実行

```bash
streamlit run app.py
```

### 2. 画像の処理
1. ブラウザでアプリケーションにアクセス
2. 画像をアップロード（複数選択可能）
3. 「処理開始」ボタンをクリック
4. 処理完了後、結果をダウンロード

### 3. 結果の確認
- **成功**: 処理済み画像をダウンロード
- **失敗**: エラーメッセージが表示

## 🔧 FANZA規約対応

### 規約第6条の実装

- **（1）モザイクサイズ**: 画像長辺×1/100の自動計算
- **（2）視覚的不明瞭**: ピクセル化による細部の不明瞭化
- **（3）技術的不可逆**: 元の表現に戻せない処理
- **（4）範囲指定**: 輪郭線を含む完全隠蔽
- **（5）必要部位**: 検出された全性器領域への処理
- **（6）処理の完全性**: 必要な部分への全体的な隠蔽

### モザイク処理仕様

- **基本サイズ**: 最小4ピクセル平方
- **動的サイズ**: 画像長辺400px以上で長辺×1/100
- **処理方法**: ピクセル化 + 境界線ぼかし
- **適用範囲**: 検出された性器領域全体

## 🌐 Render でのデプロイ

### 1. GitHubリポジトリの準備
```bash
git add .
git commit -m "Update for Render deployment"
git push origin main
```

### 2. Renderでの設定
1. [Render](https://render.com/)にアクセス
2. GitHubアカウントでログイン
3. 「New +」→「Web Service」をクリック
4. GitHubリポジトリを連携
5. 以下の設定を行う：
   - **Name**: `fanza-mosaic-tool`
   - **Environment**: `Python 3`
   - **Build Command**: `pip install -r requirements.txt`
   - **Start Command**: `streamlit run app.py --server.port $PORT --server.address 0.0.0.0`
6. 「Create Web Service」をクリック

### 3. 共有方法
生成されたURL（例：`https://fanza-mosaic-tool.onrender.com`）を共有するだけです。

## ⚠️ 注意事項

- 処理に失敗した画像はエラーメッセージが表示されます
- 高解像度画像は処理時間が長くなる場合があります
- アニメ/イラスト系の画像に最適化されています
- Renderの無料プランは15分でスリープします

## 🐛 トラブルシューティング

### よくある問題

1. **性器領域が検出されない**
   - 画像の解像度を確認
   - 人体が明確に描かれているか確認

2. **処理が遅い**
   - 画像サイズを確認
   - 同時処理数を減らす

3. **エラーが発生する**
   - ログを確認
   - 画像形式が対応しているか確認

## 📝 技術仕様

### 使用技術
- **Python 3.9+**
- **MediaPipe**: Google提供の人体検出ライブラリ
- **OpenCV**: 高速画像処理ライブラリ（ヘッドレス版）
- **Streamlit**: Web UIフレームワーク

### 処理フロー
1. 画像アップロード・前処理
2. MediaPipeによる人体・性器検出
3. 検出領域の自動特定
4. FANZA規約準拠のピクセル化モザイク
5. 境界線のぼかし処理
6. 結果のダウンロード提供

## 🤝 貢献

バグ報告や機能要望は、GitHubのIssueでお知らせください。

## 📄 ライセンス

このプロジェクトはMITライセンスの下で公開されています。

---

**作成日**: 2024年12月  
**バージョン**: 2.0 (Render対応版)  
**作成者**: AI Assistant
