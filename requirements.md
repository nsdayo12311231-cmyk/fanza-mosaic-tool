# FANZA同人出版用モザイクツール 要件定義書

## 1. プロジェクト概要

### 1.1 目的
FANZA同人に出版する画像を、FANZA隠蔽処理規約に準拠してモザイクを自動でかけるツールの開発

### 1.2 対象ユーザー
- プログラミング経験のない一般ユーザー
- アニメ/イラスト系の同人作品を制作するクリエイター
- FANZAでの出版を検討している作者

### 1.3 制約条件
- 無課金環境での運用を想定
- 他者への共有方法は未定
- **推奨サーバー**: Streamlit Cloud (完全無料)

## 2. 機能要件

### 2.1 基本機能
- **完全自動化**: 性器検出からモザイク処理まで全自動実行
- **ワンクリック実行**: ユーザーは画像配置のみで処理開始
- **バッチ処理**: 複数画像の一括処理対応

### 2.2 画像処理機能
- **性器検出**: MediaPipeによる自動検出
- **モザイク処理**: ピクセル化による隠蔽
- **境界線処理**: モザイク境界のぼかし処理
- **FANZA規約準拠**: 画像長辺×1/100のモザイクサイズ

### 2.3 ファイル管理機能
- **入力**: `input/`フォルダからの画像読み込み
- **出力**: 処理成功時は`output/`フォルダに保存
- **エラー処理**: 処理失敗時は`error/`フォルダに移動

## 3. 非機能要件

### 3.1 性能要件
- **処理速度**: 1枚あたり5秒以内での完了
- **対応解像度**: 400px以上の画像に対応
- **画像形式**: 一般的な画像形式（PNG, JPG等）に対応

### 3.2 品質要件
- **FANZA規約準拠**: 第6条の隠蔽処理規約に完全準拠
- **検出精度**: アニメ/イラスト系での高精度検出
- **モザイク強度**: 視覚的に不明瞭な状態の保証

### 3.3 操作性要件
- **直感的UI**: 非技術者でも迷わず操作可能
- **エラー表示**: 処理状況の分かりやすい表示
- **進捗表示**: 処理の進行状況の可視化

## 4. 技術要件

### 4.1 技術スタック
```
Python + MediaPipe + OpenCV + Streamlit
├── 性器検出: MediaPipe (アニメ/イラスト対応)
├── 画像処理: OpenCV (ピクセル化 + 境界線ぼかし)
├── Web UI: Streamlit (ワンクリック実行)
├── モザイク処理: カスタムアルゴリズム
└── 設定管理: YAML/JSON
```

### 4.2 主要ライブラリ
- **MediaPipe**: Google提供の無料人体検出ライブラリ
- **OpenCV**: 高速画像処理ライブラリ
- **Streamlit**: シンプルなWeb UIフレームワーク
- **PIL (Pillow)**: 画像形式変換・基本処理

### 4.3 アニメ/イラスト特化機能
- **線画検出**: アニメの特徴的な線の太さ・色を考慮
- **色域フィルタ**: 肌色・髪色などの検出精度向上
- **形状パターン**: アニメ特有の表現パターンの学習

## 5. FANZA隠蔽処理規約対応

### 5.1 規約第6条の実装
- **（1）モザイクサイズ**: 画像長辺×1/100の自動計算
- **（2）視覚的不明瞭**: ピクセル化による細部の不明瞭化
- **（3）技術的不可逆**: 元の表現に戻せない処理
- **（4）範囲指定**: 輪郭線を含む完全隠蔽
- **（5）必要部位**: 検出された全性器領域への処理
- **（6）処理の完全性**: 必要な部分への全体的な隠蔽

### 5.2 モザイク処理仕様
- **基本サイズ**: 最小4ピクセル平方
- **動的サイズ**: 画像長辺400px以上で長辺×1/100
- **処理方法**: ピクセル化 + 境界線ぼかし
- **適用範囲**: 検出された性器領域全体

## 6. システム構成

### 6.1 フォルダ構成
```
mozaic/
├── input/          # 元画像格納フォルダ
├── output/         # 処理成功画像保存フォルダ
├── error/          # 処理失敗画像保存フォルダ
├── app.py          # メインアプリケーション
├── mosaic_processor.py  # モザイク処理エンジン
├── requirements.txt      # 依存関係定義
└── README.md            # 使用方法説明書
```

### 6.2 処理フロー
1. 画像読み込み・前処理
2. MediaPipeによる人体・性器検出
3. 検出領域の自動特定
4. FANZA規約準拠のピクセル化モザイク
5. 境界線のぼかし処理
6. 結果判定・適切なフォルダへの振り分け

## 7. 開発フェーズ

### 7.1 Phase 1: 基本機能実装
- 基本的なモザイク処理エンジンの開発
- MediaPipeによる性器検出の実装
- FANZA規約準拠のモザイク処理

### 7.2 Phase 2: UI/UX向上
- StreamlitによるWeb UIの実装
- エラー処理・進捗表示の改善
- バッチ処理の最適化

### 7.3 Phase 3: 精度向上
- アニメ/イラスト特化の検出精度向上
- 処理速度の最適化
- エラーハンドリングの強化

## 8. リスク・課題

### 8.1 技術的課題
- **検出精度**: アニメ/イラストの多様性への対応
- **処理速度**: 高解像度画像での5秒以内完了
- **誤検出**: 性器以外の部位への誤ったモザイク処理

### 8.2 運用課題
- **無課金制限**: 外部APIの利用制限
- **ユーザビリティ**: 非技術者への分かりやすさ
- **保守性**: 継続的な精度向上の必要性

## 9. 成功基準

### 9.1 機能面
- FANZA隠蔽処理規約への完全準拠
- アニメ/イラスト系での90%以上の検出精度
- 1枚あたり5秒以内での処理完了

### 9.2 ユーザビリティ面
- 非技術者でも迷わず操作可能
- エラー時の適切な案内表示
- 処理状況の分かりやすい可視化

## 10. 今後の検討事項

### 10.1 機能拡張
- 複数のモザイクスタイル対応
- カスタム設定の保存・読み込み
- 処理履歴の管理

### 10.2 技術向上
- より高精度な検出アルゴリズムの導入
- 処理速度のさらなる最適化
- 多言語対応

## 11. デプロイ・共有方法

### 11.1 推奨サーバー
- **Streamlit Cloud**: 完全無料、GitHub連携で自動デプロイ
- **共有方法**: URLを送るだけ（例：https://your-app-name.streamlit.app）
- **制限**: 月間1GBストレージ、同時接続数制限

### 11.2 デプロイ手順
1. GitHubリポジトリにコードをプッシュ
2. Streamlit CloudでGitHubリポジトリを連携
3. 自動デプロイ完了
4. 生成されたURLを共有

### 11.3 運用上の注意点
- 無料プランの制限を考慮した設計
- 画像の一時保存のみ（永続化しない）
- セキュリティ面での配慮（アップロード制限等）

---

**作成日**: 2024年12月
**バージョン**: 1.0
**作成者**: AI Assistant
