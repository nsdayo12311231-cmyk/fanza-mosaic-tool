# FANZA同人出版用モザイクツール 要件定義書

## 1. プロジェクト概要

### 1.1 目的
FANZA同人に出版する画像を、FANZA隠蔽処理規約に準拠してモザイクを自動でかけるツールの開発

### 1.2 対象ユーザー
- **エンジニア・開発者**
- プログラミング経験のあるユーザー
- アニメ/イラスト系の同人作品を制作するクリエイター
- FANZAでの出版を検討している作者

### 1.3 制約条件
- **GitHubでの共有**: コードベースの直接共有
- **ローカル実行**: サーバー公開なし、個人環境での実行
- **無課金環境**: 外部サービスへの課金なし

## 2. 機能要件

### 2.1 基本機能
- **完全自動化**: 性器検出からモザイク処理まで全自動実行
- **コマンドライン実行**: エンジニア向けのCLIインターフェース
- **バッチ処理**: 複数画像の一括処理対応
- **設定ファイル**: YAML/JSONでの設定管理

### 2.2 画像処理機能
- **性器検出**: MediaPipeによる自動検出
- **モザイク処理**: ピクセル化による隠蔽
- **境界線処理**: モザイク境界のぼかし処理
- **FANZA規約準拠**: 画像長辺×1/100のモザイクサイズ

### 2.3 ファイル管理機能
- **入力**: 指定されたディレクトリからの画像読み込み
- **出力**: 処理成功時は指定ディレクトリに保存
- **エラー処理**: 処理失敗時のログ出力とエラーファイル保存

## 3. 非機能要件

### 3.1 性能要件
- **処理速度**: 1枚あたり5秒以内での完了
- **対応解像度**: 400px以上の画像に対応
- **画像形式**: 一般的な画像形式（PNG, JPG等）に対応

### 3.2 品質要件
- **FANZA規約準拠**: 第6条の隠蔽処理規約に完全準拠
- **検出精度**: アニメ/イラスト系での高精度検出
- **モザイク強度**: 視覚的に不明瞭な状態の保証

### 3.3 操作性要件
- **CLI優先**: コマンドラインでの操作を基本とする
- **設定ファイル**: 設定の外部化とカスタマイズ性
- **ログ出力**: 詳細な処理状況とエラー情報の表示

## 4. 技術要件

### 4.1 技術スタック
```
Python + MediaPipe + OpenCV + Click (CLI)
├── 性器検出: MediaPipe (アニメ/イラスト対応)
├── 画像処理: OpenCV (ピクセル化 + 境界線ぼかし)
├── CLI: Click (コマンドラインインターフェース)
├── モザイク処理: カスタムアルゴリズム
└── 設定管理: YAML/JSON
```

### 4.2 主要ライブラリ
- **MediaPipe**: Google提供の無料人体検出ライブラリ
- **OpenCV**: 高速画像処理ライブラリ
- **Click**: Python CLIフレームワーク
- **PIL (Pillow)**: 画像形式変換・基本処理

### 4.3 アニメ/イラスト特化機能
- **線画検出**: アニメの特徴的な線の太さ・色を考慮
- **色域フィルタ**: 肌色・髪色などの検出精度向上
- **形状パターン**: アニメ特有の表現パターンの学習

## 5. FANZA隠蔽処理規約対応

### 5.1 規約第6条の実装
- **（1）モザイクサイズ**: 画像長辺×1/100の自動計算
- **（2）視覚的不明瞭**: ピクセル化による細部の不明瞭化
- **（3）技術的不可逆**: 元の表現に戻せない処理
- **（4）範囲指定**: 輪郭線を含む完全隠蔽
- **（5）必要部位**: 検出された全性器領域への処理
- **（6）処理の完全性**: 必要な部分への全体的な隠蔽

### 5.2 モザイク処理仕様
- **基本サイズ**: 最小4ピクセル平方
- **動的サイズ**: 画像長辺400px以上で長辺×1/100
- **処理方法**: ピクセル化 + 境界線ぼかし
- **適用範囲**: 検出された性器領域全体

## 6. システム構成

### 6.1 フォルダ構成
```
mozaic/
├── src/                    # ソースコード
│   ├── __init__.py
│   ├── mosaic_processor.py # モザイク処理エンジン
│   └── cli.py             # CLIインターフェース
├── config/                 # 設定ファイル
│   ├── default.yaml       # デフォルト設定
│   └── user_config.yaml   # ユーザー設定
├── tests/                  # テストコード
├── examples/               # 使用例
├── docs/                   # ドキュメント
├── requirements.txt        # 依存関係定義
├── setup.py               # インストール設定
├── README.md              # 使用方法説明書
└── requirements.md         # 要件定義書
```

### 6.2 処理フロー
1. コマンドライン引数の解析
2. 設定ファイルの読み込み
3. 画像読み込み・前処理
4. MediaPipeによる人体・性器検出
5. 検出領域の自動特定
6. FANZA規約準拠のピクセル化モザイク
7. 境界線のぼかし処理
8. 結果保存・ログ出力

## 7. 開発フェーズ

### 7.1 Phase 1: 基本機能実装
- 基本的なモザイク処理エンジンの開発
- MediaPipeによる性器検出の実装
- FANZA規約準拠のモザイク処理

### 7.2 Phase 2: CLI実装
- ClickフレームワークによるCLI実装
- 設定ファイルの外部化
- バッチ処理の最適化

### 7.3 Phase 3: エンジニア向け機能
- ログ出力の詳細化
- 設定のカスタマイズ性向上
- テストコードの充実

## 8. リスク・課題

### 8.1 技術的課題
- **検出精度**: アニメ/イラストの多様性への対応
- **処理速度**: 高解像度画像での5秒以内完了
- **誤検出**: 性器以外の部位への誤ったモザイク処理

### 8.2 運用課題
- **ユーザビリティ**: エンジニア向けの操作性
- **保守性**: 継続的な精度向上の必要性
- **ドキュメント**: 技術的な使用方法の説明

## 9. 成功基準

### 9.1 機能面
- FANZA隠蔽処理規約への完全準拠
- アニメ/イラスト系での90%以上の検出精度
- 1枚あたり5秒以内での処理完了

### 9.2 ユーザビリティ面
- エンジニアが迷わず操作可能
- 設定のカスタマイズが容易
- エラー時の適切なログ出力

## 10. 今後の検討事項

### 10.1 機能拡張
- 複数のモザイクスタイル対応
- カスタム設定の保存・読み込み
- 処理履歴の管理

### 10.2 技術向上
- より高精度な検出アルゴリズムの導入
- 処理速度のさらなる最適化
- 多言語対応

## 11. GitHub共有・エンジニア向けシステム

### 11.1 共有方法
- **GitHubリポジトリ**: コードベースの直接共有
- **使用方法**: リポジトリのクローン・セットアップ
- **対象ユーザー**: プログラミング経験のあるエンジニア

### 11.2 セットアップ手順
1. GitHubリポジトリのクローン
2. 依存関係のインストール
3. 設定ファイルのカスタマイズ
4. CLIコマンドでの実行

### 11.3 運用上の注意点
- サーバー公開なし（ローカル実行のみ）
- 外部サービスへの依存なし
- エンジニア向けの技術的説明

---

**作成日**: 2024年12月
**バージョン**: 2.0 (GitHub共有・エンジニア向け版)
**作成者**: AI Assistant
